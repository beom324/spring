<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>
<body>
	<h2>상품등록</h2>
	<div id="goodsForm">
		<input type="hidden" v-model="g.no" /><br />
		상품이름 : <input type="text" v-model="g.item" /><br />
		상품가격 : <input type="text" v-model="g.price" /><br />
		상품수량 : <input type="text" v-model="g.qty" /><br />	
		상품사진 : <input type="file" v-on:change="fileChange" /><br />		
		<img  v-if="g.fname"  :src="'/images/'+g.fname"  width="100" height="100" />
		<button v-on:click="updateGoods('/insert')">등록</button>
		<button v-on:click="updateGoods('/update')">수정</button>
	</div>
	
	<table id="listGoods">
		<thead>
			<tr>
				<th>상품번호</th>
				<th>상품명</th>
				<th>수량</th>
				<th>가격</th>				
			</tr>
		</thead>
		<tbody>
			<tr v-for="g in list" v-on:click="selectGoods(g)">
				<td>{{g.no}}</td>
				<td>{{g.item}}</td>
				<td>{{g.price}}</td>
				<td>{{g.qty}}</td>				
			</tr>
		</tbody>
	</table>
	
	
	<script>
		const axiosConfig = {
			headers:{
				"Content-Type":"multipart/form-data"				
			}
		}
		
		var goodsForm = new Vue({
			el:"#goodsForm",
			data:{
				g:{no:0,item:"",price:0,qty:0,uploadFile:null,fname:""}
			},
			methods:{
				fileChange:function(event){
					this.g.uploadFile = event.target.files[0];
				},
				updateGoods:function(url){
					var f = new FormData();
					f.append("no", this.g.no);
					f.append("item", this.g.item);
					f.append("price", this.g.price);
					f.append("qty", this.g.qty);
					f.append("fname",this.g.fname);
					f.append("uploadFile", this.g.uploadFile);
					axios.post(url, f, axiosConfig).then(function(){
						location.reload()
					});
				}
			}
		});
		
		axios.get("/listGoods").then(function(res){
			var listGoods = new Vue({
				el:"#listGoods",
				data:{
						list:res.data			
				},
				methods:{
					selectGoods:function(g){
						goodsForm.g = g;
						console.log(goodsForm.g);
					}
				}
			});
		});
		
	</script>
	
</body>
</html>
